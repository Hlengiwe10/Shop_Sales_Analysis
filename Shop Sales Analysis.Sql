SELECT
    TRANSACTION_ID,
    TRANSACTION_DATE,
    TRANSACTION_TIME,
    TRANSACTION_QTY,
    STORE_ID,
    STORE_LOCATION,
    PRODUCT_ID,
    UNIT_PRICE,
    PRODUCT_CATEGORY,
    PRODUCT_TYPE,
    SUM(TRANSACTION_QTY * UNIT_PRICE) AS Total_Revenue,
    AVG(TRANSACTION_QTY) AS Average_Transaction_Size,
    CASE
        WHEN TRANSACTION_TIME BETWEEN '06:00:00' AND '10:59:00' THEN 'Morning'
        WHEN TRANSACTION_TIME BETWEEN '11:00:00' AND '14:59:00' THEN 'Day'
        WHEN TRANSACTION_TIME BETWEEN '16:00:00' AND '19:59:00' THEN 'Afternoon'
        ELSE 'Night'
    END AS Time_buckets,
    CASE
        WHEN UNIT_PRICE <= 2.00 THEN 'Cheaper'
        WHEN UNIT_PRICE BETWEEN 2.01 AND 3.00 THEN 'Normal_Price'
        WHEN UNIT_PRICE BETWEEN 3.01 AND 4.00 THEN 'Pricey'
        ELSE 'Too_Expensive'
    END AS Price_buckets,
    CASE
        WHEN TRANSACTION_QTY < 1 THEN 'Not buying'
        WHEN TRANSACTION_QTY = 1 THEN 'Buyer'
        ELSE 'Regular'
    END AS Customer_behaviour_bucket
FROM "SHOP_ANALYSIS"."TRANSACTIONS"."SHOPPING"
GROUP BY
    TRANSACTION_ID,
    TRANSACTION_DATE,
    TRANSACTION_TIME,
    TRANSACTION_QTY,
    STORE_ID,
    STORE_LOCATION,
    PRODUCT_ID,
    UNIT_PRICE,
    PRODUCT_CATEGORY,
    PRODUCT_TYPE;
